#!/bin/bash
# OpenClaw Blog Post Creator con Leonardo AI
# Usage: create-post-full.sh "Titolo Post" "Descrizione breve" "Categoria"

TITLE="$1"
DESCRIPTION="$2"
CATEGORY="${3:-audiolibri}"

if [ -z "$TITLE" ]; then
  echo "❌ Usage: create-post-full.sh 'Post Title' 'Description' [category]"
  exit 1
fi

# Genera slug
SLUG=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | tr ' ' '-' | tr -cd '[:alnum:]-')
DATE=$(date +%Y-%m-%d)
DATETIME=$(date --iso-8601=seconds)
POST_FILE="content/posts/${DATE}-${SLUG}.md"

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🚀 OPENCLAW BLOG POST GENERATOR"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📝 Titolo: $TITLE"
echo "📂 Slug: $SLUG"
echo "📅 Data: $DATE"
echo ""

# Step 1: Genera immagine cover con Leonardo AI
echo "🎨 Step 1/3: Generating cover image..."
IMAGE_PROMPT="audiobook cover for $TITLE, professional book design, cinematic lighting"
IMAGE_FILE="static/images/${SLUG}.png"

python3 scripts/leonardo-generate.py "$IMAGE_PROMPT" "$IMAGE_FILE"

if [ ! -f "$IMAGE_FILE" ]; then
  echo "⚠️ Image generation failed, creating post without cover..."
  IMAGE_FILE=""
fi

# Step 2: Crea contenuto post
echo ""
echo "📄 Step 2/3: Creating post file..."

cat > "$POST_FILE" << POSTEOF
---
title: "$TITLE"
date: $DATETIME
draft: false
tags: ["audiolibri", "recensioni", "$CATEGORY"]
cover:
  image: /images/${SLUG}.png
  alt: "$TITLE - Copertina Audiolibro"
  caption: "Cover generata con Leonardo AI"
categories: ["recensioni"]
description: "$DESCRIPTION"
---

## Recensione

$DESCRIPTION

### Contenuto

[Completare questa sezione con i dettagli del libro]

### Qualità Audio

[Valutazione qualità narrazione]

### Per Chi è Consigliato

[Target audience]

### Conclusione

[Valutazione finale]

**Valutazione: ⭐⭐⭐⭐ (4/5)**
POSTEOF

echo "✅ Post created: $POST_FILE"

# Step 3: Git commit e push
echo ""
echo "📦 Step 3/3: Deploying to GitHub..."

cd ~/audiobookitaliani-blog
git add "$POST_FILE" "$IMAGE_FILE" 2>/dev/null
git commit -m "📚 New post: $TITLE (auto-generated with Leonardo AI)"
git push

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🎉 POST PUBBLICATO CON SUCCESSO!"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📝 File: $POST_FILE"
echo "🖼️ Cover: $IMAGE_FILE"
echo "🌐 URL (tra 2 min): https://www.audiobookitaliani.com/posts/${DATE}-${SLUG}/"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
