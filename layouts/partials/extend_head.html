<style>
#cookie-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #2c3e50;
    color: white;
    padding: 20px;
    text-align: center;
    z-index: 9999;
    display: none;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
}

#cookie-banner.show {
    display: block;
}

#cookie-banner p {
    margin: 0 0 15px 0;
    font-size: 14px;
    line-height: 1.6;
}

#cookie-banner a {
    color: #3498db;
    text-decoration: underline;
}

#cookie-banner button {
    background: #27ae60;
    color: white;
    border: none;
    padding: 10px 25px;
    margin: 0 5px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 14px;
    font-weight: 600;
}

#cookie-banner button:hover {
    background: #229954;
}

#cookie-banner .btn-secondary {
    background: #95a5a6;
}

#cookie-banner .btn-secondary:hover {
    background: #7f8c8d;
}

#cookie-settings {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    color: #2c3e50;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    z-index: 10000;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

#cookie-settings.show {
    display: block;
}

#cookie-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 9998;
}

#cookie-overlay.show {
    display: block;
}

.cookie-category {
    margin: 15px 0;
    padding: 15px;
    background: #ecf0f1;
    border-radius: 5px;
}

.cookie-category label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 600;
}

.cookie-category input[type="checkbox"] {
    margin-right: 10px;
    width: 20px;
    height: 20px;
}

.cookie-category p {
    margin: 10px 0 0 30px;
    font-size: 13px;
    color: #555;
}
</style>

<!-- Cookie Banner HTML (in head cos√¨ viene sempre caricato) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Iniettiamo HTML dopo body
    var cookieHTML = `
<div id="cookie-overlay"></div>

<div id="cookie-banner">
    <p>üç™ Questo sito utilizza cookie tecnici essenziali e, previo consenso, cookie analitici e di affiliazione Amazon. 
    <a href="/privacy" style="color: #3498db;">Leggi la Privacy Policy</a></p>
    <button onclick="acceptAllCookies()">Accetta tutti</button>
    <button class="btn-secondary" onclick="showCookieSettings()">Personalizza</button>
    <button class="btn-secondary" onclick="rejectAllCookies()">Rifiuta</button>
</div>

<div id="cookie-settings">
    <h2>‚öôÔ∏è Impostazioni Cookie</h2>
    <div class="cookie-category">
        <label>
            <input type="checkbox" id="cookie-necessary" checked disabled>
            Cookie Tecnici (Obbligatori)
        </label>
        <p>Necessari per il funzionamento del sito. Non possono essere disabilitati.</p>
    </div>
    
    <div class="cookie-category">
        <label>
            <input type="checkbox" id="cookie-analytics">
            Cookie Analitici
        </label>
        <p>Ci aiutano a capire come i visitatori interagiscono con il sito.</p>
    </div>
    
    <div class="cookie-category">
        <label>
            <input type="checkbox" id="cookie-marketing">
            Cookie di Affiliazione Amazon
        </label>
        <p>Per tracciare i clic sui link affiliati e guadagnare commissioni.</p>
    </div>
    
    <button onclick="saveCustomSettings()" style="background: #27ae60; color: white; border: none; padding: 10px 25px; margin: 10px 5px 0 0; cursor: pointer; border-radius: 5px;">Salva preferenze</button>
    <button onclick="hideCookieSettings()" style="background: #95a5a6; color: white; border: none; padding: 10px 25px; margin: 10px 0 0 5px; cursor: pointer; border-radius: 5px;">Chiudi</button>
</div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', cookieHTML);
    
    // Cookie management functions
    window.getCookie = function(name) {
        const value = '; ' + document.cookie;
        const parts = value.split('; ' + name + '=');
        if (parts.length === 2) return parts.pop().split(';').shift();
    };
    
    window.setCookie = function(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        document.cookie = name + '=' + value + ';expires=' + date.toUTCString() + ';path=/;SameSite=Lax';
    };
    
    window.acceptAllCookies = function() {
        setCookie('cookie_consent', 'all', 365);
        setCookie('cookie_analytics', 'true', 365);
        setCookie('cookie_marketing', 'true', 365);
        document.getElementById('cookie-banner').classList.remove('show');
        console.log('‚úÖ Tutti i cookie accettati');
    };
    
    window.rejectAllCookies = function() {
        setCookie('cookie_consent', 'necessary', 365);
        setCookie('cookie_analytics', 'false', 365);
        setCookie('cookie_marketing', 'false', 365);
        document.getElementById('cookie-banner').classList.remove('show');
        console.log('‚ùå Solo cookie necessari');
    };
    
    window.showCookieSettings = function() {
        document.getElementById('cookie-settings').classList.add('show');
        document.getElementById('cookie-overlay').classList.add('show');
        document.getElementById('cookie-banner').classList.remove('show');
        
        // Carica preferenze salvate
        document.getElementById('cookie-analytics').checked = getCookie('cookie_analytics') === 'true';
        document.getElementById('cookie-marketing').checked = getCookie('cookie_marketing') === 'true';
    };
    
    window.hideCookieSettings = function() {
        document.getElementById('cookie-settings').classList.remove('show');
        document.getElementById('cookie-overlay').classList.remove('show');
    };
    
    window.saveCustomSettings = function() {
        const analytics = document.getElementById('cookie-analytics').checked;
        const marketing = document.getElementById('cookie-marketing').checked;
        
        setCookie('cookie_consent', 'custom', 365);
        setCookie('cookie_analytics', analytics, 365);
        setCookie('cookie_marketing', marketing, 365);
        
        hideCookieSettings();
        console.log('‚úÖ Preferenze salvate:', { analytics, marketing });
    };
    
    // Funzione globale per link footer
    window.openCookieSettings = function() {
        showCookieSettings();
    };
    
    // Mostra banner se non ha gi√† scelto
    const consent = getCookie('cookie_consent');
    if (!consent) {
        setTimeout(function() {
            document.getElementById('cookie-banner').classList.add('show');
        }, 500);
    }
    console.log('üç™ Cookie consent status:', consent);
    
    // Chiudi modal cliccando overlay
    document.getElementById('cookie-overlay').addEventListener('click', hideCookieSettings);
});
</script>
